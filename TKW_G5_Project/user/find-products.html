<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tat ca san pham</title>
    <link rel="stylesheet" href="../includes/style.css">
    <script src="https://kit.fontawesome.com/6dd3e0021a.js" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>

<body>
    <header>
        <div class="navbar">
            <a href="../index.html">
                <img class="logo" src="../user/imgs/logo.avif">
            </a>
            <ul class="links">
                <li class="hideMenuBar"><a class="active-menu" href="../index.html">Home</a></li>
                <li class="hideMenuBar"><a href="../user/about-page.html">About</a></li>
                <li class="hideMenuBar"><a href="../user/contact-page.html">Contact</a></li>
                <li class="hideMenuBar">
                    <a href="../user/find-products.html" id="store">Danh Mục Sản Phẩm</a>
                    <!-- Trong store có drop down menu -->
                    <div class="dropdown">
                        <ul class="menu-inside">
                            <li><a href="#" id="loai-sp">Quần</a>
                                <ul class="menu-inside2 cac-loai-quan">
                                    <li><a href="../user/find-products.html?filter=quan-ngan">Quần ngắn</a></li>
                                    <li><a href="../user/find-products.html?filter=quan-dai">Quần dài</a></li>
                                </ul>
                            </li>

                            <li><a href="#" id="loai-sp">Áo</a>
                                <ul class="menu-inside2 cac-loai-ao">
                                    <li><a href="../user/find-products.html?filter=ao-thun">Áo thun</a></li>
                                    <li><a href="../user/find-products.html?filter=ao-khoac">Áo khoác</a></li>
                                </ul>
                            </li>
                            <li><a href="#" id="loai-sp">Phụ kiện</a>
                                <ul class="menu-inside2 cac-loai-phukien">
                                    <li><a href="../user/find-products.html?filter=phukien-balo">Balo</a></li>
                                    <li><a href="../user/find-products.html?filter=phukien-tui">Túi</a></li>
                                </ul>
                            </li>

                        </ul>
                    </div>
                </li>
            </ul>

            <ul class="ults">
                <li class="hideMenuBar">
                    <!-- chỗ này m làm một js, trước khi đăng nhập thì link sigIn-signup/signIn-Up;
                    sau khi đăng nhập là link information/address -->
                    <a id="user-login" onclick="dieuHuongUser()">
                        <div class="login-btn">
                            <i class="fa-solid fa-user"></i>
                        </div>
                    </a>
                </li>

                <li class="hideMenuBar">
                    <a>
                        <div class="search_btn">
                            <form method="get" action="../user/find-products.html?search=">
                                <input type="search" placeholder="Search" class="search-text" required name="search">
                                <button class="nut-search"><i class="fa-solid fa-magnifying-glass"></i></button>
                            </form>
                        </div>
                    </a>
                </li>

                <li class="hideMenuBar">
                    <a>
                        <div class="cart-btn">
                            <i class="fa-solid fa-cart-shopping" id="cart-icon"></i>
                        </div>
                    </a>
                </li>

                <li onclick="showSidebar()" class="btn-menu">
                    <a>
                        <div class="menubar">
                            <i class="fa-solid fa-bars" id="menubar"></i>
                        </div>
                    </a>
                </li>

                <li class="hideMenuBar">
                    <a href="#" style="cursor: pointer;" hidden id="logout">
                        <div >
                            <i class="fa-solid fa-right-from-bracket fa-2xl" style="color: #ffffff;"></i>
                        </div>
                    </a>
                </li>
            </ul>

            <!-- Side bar menu -->
            <ul class="sidebar">
                <li onclick="hideSideBar()"><a href="#"><i class="fa-solid fa-xmark"></i></a></li>
                <li><a href="index.html">Home</a></li>
                <li><a href="..user/about-page.html">About</a></li>
                <li><a href="../user/contact-page.html">Contact</a></li>
                <li><a href="#">Store</a></li>
                <li><a href="#">Login</a></li>
                <li><a href="../user/cart-page.html">Shopping cart</a></li>
            </ul>

            <!-- Shopping cart  -->
            <div class="cart">
                <h2 class="cart-title">Giỏ hàng</h2>

                <!-- content -->
                <div class="cart-content" id="cart-content">

                </div>

                <div class="total">
                    <div class="total-title">Tổng tiền</div>
                    <div class="total-price" id="total-price">0</div>
                </div>

                <div style="display: flex; justify-content: center;align-items: center;">
                    <button type="button" class="btn-buy" onclick="muaHang()">Buy Now</button>
                    <a href="../user/cart-page.html" style="text-decoration: none;"><button type="button"
                            class="btn-view">View Cart</button></a>
                </div>
                <i class="fa-solid fa-xmark" id="close-cart"></i>
            </div>

        </div>
    </header>

    <main style="display: block; margin-top: 85px;">
        <div id="wrapper">
            <!-- <div class="container-filter">
                <button class="active-filter" data-name="all">Tất cả sản phẩm</button>
                <button data-name="ao">Áo</button>
                <button data-name="quan">Quần</button>
                <button data-name="phukien">Phụ kiện</button>
            </div> -->
            <ul class="products">
            </ul>
        </div>
    </main>


    <footer>
        <div class="container-footer">
            <div class="footer_1">
                <img src="../user/imgs/logo.avif" class="logo">
                <p>Thương hiệu thời trang số một.</p>
                <div class="f_icon">
                    <i class="fa-brands fa-facebook"></i>
                    <i class="fa-brands fa-instagram"></i>
                    <i class="fa-brands fa-youtube"></i>
                    <i class="fa-brands fa-tiktok"></i>
                </div>
            </div>

            <div class="footer_2">
                <h3>SHOPPING</h3>
                <a href="../index.html">Home Page</a>
                <a href="../user/about-page.html">About</a>
                <a href="../user/contact-page.html">Contact</a>
                <!-- <a href="index.html">Store</a> -->
            </div>

            <div class="footer_3">
                <h3>HỖ TRỢ</h3>
                <a href="#">Chính sách</a>
                <a href="#">Liên hệ với chúng tôi</a>
                <a href="#">Phương thức thanh toán</a>
                <a href="#">Vận chuyển</a>
            </div>

            <div class="footer_4">
                <hr>
                <h3>Đăng ký nhận bản tin</h3>
                <input id="input_email" type="email" placeholder="Email của bạn">
                <input id="input_sub" type="button" value="Đăng ký">
            </div>

        </div>
    </footer>
</body>

<!-- <script src="includes/find_products.js"></script> -->
<script src="../includes/script.js"></script>
<script src="../admin/datas/sanpham.js"></script>
<script>
    let search;
    let checkFilter = false;
    let data;
    let luuFilter;
    $(document).ready(function () {
        let urlParams = new URLSearchParams(document.location.search);
        search = urlParams.get('search');

        const url = window.location.href;
        const urlObj = new URL(url);
        const params = new URLSearchParams(urlObj.search);
        let filter = params.get('filter');
        if (!isEmpty(search)) {
            console.log(search);
        }
        if (!isEmpty(filter)) {
            // console.log(filter);
            luuFilter = filter;
            checkFilter = true;
        }
        data = arraySanPham;
        themDuLieu(data);
    });

    function isEmpty(input) {
        return (input == null || input.length == 0);
    }

    function layDuongDan(giaTri) {
        giaTri = giaTri.split("/").pop();
        return giaTri;
    }

    function themDuLieu(data) {
        let lST = localStorage.getItem("sp_them");
        let dsThem;
        if (!isEmpty(lST)) {
            dsThem = JSON.parse(lST);
            for (let i = dsThem.length - 1; i >= 0; i--) {
                data.push(dsThem[i]);
            }
        }

        let lSS = localStorage.getItem("sp_sua");
        if (!isEmpty(lSS)) {
            dsSua = JSON.parse(lSS);
            dsSua.some((element, index) => {
                data.some((dt, i) => {
                    if (element["id"] == dt["id"]) {
                        data[i] = dsSua[index];
                        return true;
                    }
                });
            });
        }

        let lSX = localStorage.getItem("sp_xoa");
        if (!isEmpty(lSX)) {
            dsXoa = JSON.parse(lSX);
            dsXoa.forEach(element => {
                data.some((dt, i) => {
                    if (element == dt["id"]) {
                        data.splice(i, 1);
                        return true;
                    }
                });
            });
        }
        function layDuongDanTuongDoi(giaTri) {
            giaTri = giaTri.split("/").pop();
            return giaTri;
        }
        //--
        for (let i = 0; i < data.length; i++) {
            if(!isEmpty(search)){
                if(!data[i]["ten"].toLowerCase().includes(search.toLowerCase())){
                    continue;
                }
            }
            if(checkFilter){
                if(data[i]["loaihang"] != luuFilter){
                    continue;
                }
            }
            const productItem = document.createElement('div');
            productItem.className = 'product-item';

            const productTop = document.createElement('div');
            productTop.className = 'product-top';

            const productThumb = document.createElement('a');
            productThumb.href = '../product_detail/index.html?id=' + i;
            productThumb.className = 'product-thumb';

            const productImg = document.createElement('img');
            productImg.src = '../admin/imgs/products/' + layDuongDan(data[i]["hinh_truoc"]);
            productImg.alt = 'Hinh anh cua sp ' + i;
            productThumb.appendChild(productImg);

            const buyNow = document.createElement('a');
            buyNow.href = '';
            buyNow.className = 'buy-now';
            buyNow.textContent = 'Mua ngay';


            const addCart = document.createElement('i');
            addCart.className = 'fa-solid fa-bag-shopping add-cart';
            addCart.onclick = function () {
                alert('Thêm thành công!')
                themVaoGioHang(data[i]["id"], data[i]["ten"], data[i]["dongia"], layDuongDanTuongDoi(data[i]["hinh_truoc"]));
            };
            productTop.appendChild(productThumb);
            productTop.appendChild(buyNow);
            productTop.appendChild(addCart);

            const productInfo = document.createElement('div');
            productInfo.className = 'product-info';

            const productCart = document.createElement('a');
            productCart.href = '';
            productCart.className = 'product-cart';
            productCart.textContent = data[i]["danhmuc"];

            const productName = document.createElement('a');
            productName.href = '../product_detail/index.html?id=' + i;
            productName.className = 'product-name';
            productName.textContent = data[i]["ten"];;

            const productPrice = document.createElement('div');
            productPrice.className = 'product-price';
            productPrice.textContent = parseInt(data[i]["dongia"]).toLocaleString('it-IT', { style: 'currency', currency: 'VND' });

            productInfo.appendChild(productCart);
            productInfo.appendChild(productName);
            productInfo.appendChild(productPrice);

            productItem.appendChild(productTop);
            productItem.appendChild(productInfo);

            const productLi = document.createElement('li');
            productLi.appendChild(productItem);
            let dtName = data[i]["loaihang"].split("-")[0];
            productLi.dataset.name = dtName;

            document.querySelector('.products').appendChild(productLi);
        }
    }
    $(document).ready(function () {
        var loginButton = $('#logout')[0];
        let id = localStorage.getItem("user_id");
        if (!isEmpty(id)) {
            loginButton.removeAttribute("hidden");
            loginButton.addEventListener('click', () =>{
                localStorage.removeItem("user_id");
                window.location.href = '../user/signIn-signUp/signIn-Up.html';
            });
        }
    });

    function hienThongTinCart() {
  let sSCart = sessionStorage.getItem("cart");
  $('#cart-content')[0].innerHTML = '';
  if (!isEmpty(sSCart)) {
    let cart = JSON.parse(sSCart);
    cart.forEach(element => {
      const cartBox = document.createElement('div');
      cartBox.className = 'cart-box';

      const cartImg = document.createElement('img');
      cartImg.src = "../admin/imgs/products/" + element["hinh"];
      cartImg.alt = 'hinh cua san pham cart';
      cartImg.className = 'cart-img';

      const detailBox = document.createElement('div');
      detailBox.className = 'detail-box';

      const cartProductId = document.createElement('div');
      cartProductId.className = 'cart-product-id';
      cartProductId.style.visibility = "hidden";
      cartProductId.innerText = element["id"];

      const cartProductTitle = document.createElement('div');
      cartProductTitle.className = 'cart-product-title';
      cartProductTitle.innerText = element["ten"];

      const cartPrice = document.createElement('div');
      cartPrice.className = 'cart-price';
      cartPrice.innerText = parseInt(element["gia"]).toLocaleString('it-IT', { style: 'currency', currency: 'VND' });

      const cartQuantity = document.createElement('input');
      cartQuantity.type = 'number';
      cartQuantity.value = element["soluong"];
      cartQuantity.className = 'cart-quantity';
      cartQuantity.addEventListener("change", thayDoiSoLuong);

      const cartRemove = document.createElement('i');
      cartRemove.className = 'fa-solid fa-trash cart-remove';
      cartRemove.addEventListener('click', xoaSPKhoiCart);

      detailBox.appendChild(cartProductId);
      detailBox.appendChild(cartProductTitle);
      detailBox.appendChild(cartPrice);
      detailBox.appendChild(cartQuantity);

      cartBox.appendChild(cartImg);
      cartBox.appendChild(detailBox);
      cartBox.appendChild(cartRemove);

      $('#cart-content')[0].appendChild(cartBox);
    });
    tinhTongTien();
  }
}
</script>

</html>